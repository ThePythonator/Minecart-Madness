import json

FILEPATH = "assets/levels/terrain_generation.json"

# TODO: doesn't seem to generate same as backup.json
# Work out what pairs are missing - seems to be something with ending sections again

frequencies = {
    "0": 10, "1": 20, "2": 10, "3": 2, "4": 2, "5": 2, "8": 5, "9": 10, "10": 5, "11": 1,
    "16": 5, "17": 10, "18": 5, "19": 1, "20": 3, "21": 3, "24": 5, "25": 10, "26": 5, "27": 1,
    "32": 10, "33": 20, "34": 10, "35": 2, "40": 5, "41": 10, "42": 5, "43": 1,
    # Note: not sure what happens if I use lots of freq 0 options
    # But this stops it from being chosen unless necessary
    "48": 3, "49": 3, "50": 3, "51": 1, "52": 0,
    "56": 1, "57": 1, "58": 1, "59": 1,
    "132": None, "133": None, "134": None,
    "171": None, "172": None, "187": None, "188": None, "212": None, "213": None,
    "255": 500
}

indices = [
    0,1,2,3,
    # 4,5,6,7,
    8,9,10,11,
    # 12,13,14,15,
    16,17,18,19,
    20,21,#22,23,
    24,25,26,27,
    # 28,29,30,31,
    32,33,34,35,
    # 36,37,38,39,
    40,41,42,43,
    # 44,45,46,47,
    48,49,50,51,
    52,#53,54,55,
    56,57,58,59,
    # 60,61,62,63,
    # 64,65,66,67,68,69,70,71,
    # 72,73,74,75,76,77,78,79,
    # 80,81,82,83,84,85,86,87,
    # 88,89,90,91,92,93,94,95,
    # 96,97,98,99,None,101,102,103,
    # 104,105,106,107,108,109,110,111,
    # 112,113,114,115,116,117,118,119,
    # 120,121,122,123,124,125,126,127,
    # 128,129,130,131,
    132,133,134,#135,
    # 136,137,138,139,140,141,142,143,
    # 144,145,146,147,148,149,150,151,
    # 152,153,154,155,156,157,158,159,
    # 160,161,162,163,164,165,166,167,
    # 168,169,170,
    171,172,#173,174,175,
    # 176,177,178,179,180,181,182,183,
    # 184,185,186,
    187,188,#189,190,191,
    # 192,193,194,195,196,197,198,199,
    # 200,201,202,203,204,205,206,207,
    #208,209,210,211,
    212,213,#214,215,
    # 216,217,218,219,220,221,222,223,
    # 224,225,226,227,228,229,230,231,
    # 232,233,234,235,236,237,238,239,
    # 240,241,242,243,244,245,246,247,
    # 248,249,250,251,252,253,254,
    
    255
]

terrain_tiles = [
    0,1,2,3,
    4,5,6,7,
    8,9,10,11,
    # 12,13,14,15,
    16,17,18,19,
    20,21,22,23,
    24,25,26,27,
    # 28,29,30,31,
    32,33,34,35,
    36,37,38,39,
    40,41,42,43,
    # 44,45,46,47,
    48,49,50,51,
    52,53,#54,55,
    56,57,58,59,
    # 60,61,62,63,
]

# Only core rail tiles, not extra corner bits etc
rail_tiles = [
    132,133,134,
    187,188,
    212,213,
]

all_rail_tiles = rail_tiles + [
    171,172,
]

for t in all_rail_tiles:
    frequencies[str(t)] = 50

frequencies["133"] = 500

horizontal_pairs = [
    # Basic pairs
    (0,1), (1,1), (1,2), (0,2),
    (8,9), (9,9), (9,10), (8,10),
    (16,17), (17,17), (17,18), (16,18),
    (24,25), (25,25), (25,26), (24,26),
    (32,33), (33,33), (33,34), (32,34),
    (40,41), (41,41), (41,42), (40,42),
    (48,49), (49,49), (49,50), (48,50),
    (56,57), (57,57), (57,58), (56,58),

    # Other grass pairs
    (0,21), (1,21),
    (20,1), (20,2),
    (0,52), (1,52), (52,1), (52,2),

    # Other bottom edge pairs
    (32,5), (33,5),
    (4,33), (4,34),
    (5,20), (21,4),

    # Other pairs
    (16,4), (10,4), (26,4), (42,4), (58,4),
    (17,4), (11,4), (27,4), (43,4), (59,4),
    (5,17), (5,8), (5,24), (5,40), (5,56),
    (5,18), (5,11), (5,27), (5,43), (5,59),

    (16,20), (10,20), (26,20), (42,20), (58,20),
    (17,20), (11,20), (27,20), (43,20), (59,20),
    (21,17), (21,8), (21,24), (21,40), (21,56),
    (21,18), (21,11), (21,27), (21,43), (21,59),

    (21,20),
    
    (16,8), (16,11), (16,24), (16,27), (16,40), (16,43), (16,56), (16,59),
    (17,8), (17,11), (17,24), (17,27), (17,40), (17,43), (17,56), (17,59),
    (10,17), (11,17), (26,17), (27,17), (42,17), (43,17), (58,17), (59,17),
    (10,18), (11,18), (26,18), (27,18), (42,18), (43,18), (58,18), (59,18),

    # Rail
    (132,133), (133,133), (133,134), (132,134),
    (132,187), (133,187), (132,212), (133,212),
    (188,133), (188,134), (213,133), (213,134),
    (132,172), (133,172), (171,133), (171,134),
    (171,187), (171,212), (188,172), (213,172),

    # Rail and grass
    (187,0), (187,3),
    (2,188), (3,188),
    
    # Pairs with air
    (255, 0), (2, 255), (255, 3), (3, 255),
    (255, 16), (18, 255), (255, 19), (19, 255),
    (255, 32), (34, 255), (255, 35), (35, 255),
    (255, 48), (50, 255), (255, 51), (51, 255),
    
    # Rail and air
    (255,132), (134,255),
    (255,171), (172,255),

    (255,255),
]

vertical_pairs = [
    # Basic pairs
    (0,16), (16,16), (16,32), (0,32),
    (1,17), (17,17), (17,33), (1,33),
    (2,18), (18,18), (18,34), (2,34),
    (3,19), (19,19), (19,35), (3,35),
    (8,24), (24,24), (24,40), (8,40),
    (9,25), (25,25), (25,41), (9,41),
    (10,26), (26,26), (26,42), (10,42),
    (11,27), (27,27), (27,43), (11,43),

    # Other side edge pairs
    (2,20), (18,20),
    (0,21), (16,21),
    (3,52), (19,52),

    # Other bottom edge pairs
    (4,18), (4,34),
    (5,16), (5,32),

    # Other pairs
    (1,4), (17,4), (20,4), (21,4), (40,4), (41,4), (42,4), (43,4), (52,4), (56,4), (57,4), (58,4), (59,4),
    (1,5), (17,5), (20,5), (21,5), (40,5), (41,5), (42,5), (43,5), (52,5), (56,5), (57,5), (58,5), (59,5),
     
    
    # (5,17), (21,17), 
    # (5,18), (21,18), 
    
    (1,8), (1,9), (1,10), (1,11), (1,56), (1,57), (1,58), (1,59),
    (17,8), (17,9), (17,10), (17,11), (17,56), (17,57), (17,58), (17,59),
    
    (40,17), (41,17), (42,17), (43,17), (52,17), (56,17), (57,17), (58,17), (59,17),
    (40,33), (41,33), (42,33), (43,33), (52,33), (56,33), (57,33), (58,33), (59,33),

    (20,8), (20,9), (20,10), (20,11), (20,33), (20,56), (20,57), (20,58), (20,59),
    (21,8), (21,9), (21,10), (21,11), (21,33), (21,56), (21,57), (21,58), (21,59),

    (52,8), (52,9), (52,10), (52,11), (52,56), (52,57), (52,58), (52,59),

    # Rail
    (171,187), (172,188), (171,212), (172,213),
    
    # Rail and grass
    (132,0), (132,1),
    (133,0), (133,1), (133,2), (133,3),
    (134,1), (134,2),

    (187,1), (188,1),
    (187,0), (188,2),

    # Rail and wood
    # TODO

    # Pairs with air
    (255, 0), (255, 1), (255, 2), (255, 3),
    (32, 255), (33, 255), (34, 255), (35, 255),
    (255, 48), (255, 49), (255, 50), (255, 51),
    (48, 255), (49, 255), (50, 255), (51, 255),

    # Rail and air
    (255,132), (255,133), (255,134),
    (255,171), (255,172),

    (255,255),
]

all_options = set()
for a, b in horizontal_pairs + vertical_pairs:
    all_options.add(a)
    all_options.add(b)


valid_options = {k: {"up": [], "down": [], "left": [], "right": []} for k in all_options}


for a, b in horizontal_pairs:
    valid_options[a]["right"].append(b)
    valid_options[b]["left"].append(a)

for a, b in vertical_pairs:
    valid_options[a]["down"].append(b)
    valid_options[b]["up"].append(a)

for k in valid_options:
    for l in valid_options[k]:
        valid_options[k][l].sort()

missing = []
for k in indices:
    if str(k) not in frequencies:
        missing.append(k)

if len(missing):
    print(f"Warning: missing frequencies for: {missing}")

data = {
    "all_options": frequencies,
    "valid_options": valid_options,
    "terrain_options": terrain_tiles,
    "rail_options": rail_tiles,
}

with open(FILEPATH, "w+") as f:
    json.dump(data, f)
